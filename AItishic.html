<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI提示词助手 - 提升你的AI创作效率</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- JSZip库用于创建ZIP文件 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <!-- FileSaver.js用于保存文件 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- 统一的 Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#64748b',
            accent: '#0ea5e9',
            success: '#22c55e',
            warning: '#f59e0b',
            danger: '#ef4444',
            light: '#f8fafc',
            dark: '#1e293b',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .glass-effect {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }
      .dark .glass-effect {
        background: rgba(30, 41, 59, 0.7);
      }
      .card-transition {
        transition: all 0.3s ease;
      }
      .category-item {
        transition: all 0.2s ease;
      }
      .category-item:hover {
        transform: translateX(5px);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .slide-in {
        animation: slideIn 0.3s ease-in-out;
      }
      @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      .slide-up {
        animation: slideUp 0.3s ease-in-out;
      }
      @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      .loading-spinner {
        border: 3px solid rgba(59, 130, 246, 0.3);
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .line-clamp-1 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
      }
      .line-clamp-2 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
      }
      .line-clamp-3 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3;
      }
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen flex flex-col" style="max-height: 100vh; overflow: hidden;">
  <!-- 顶部导航栏 -->
  <header class="glass-effect sticky top-0 z-50 border-b border-gray-200 dark:border-gray-700">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <!-- Logo -->
      <div class="flex items-center space-x-2">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white">
          <i class="fa fa-lightbulb-o text-xl"></i>
        </div>
        <h1 class="text-xl font-bold text-primary">AI提示词助手</h1>
      </div>
      
      <!-- 搜索框 -->
      <div class="hidden md:flex flex-1 max-w-xl mx-6">
        <div class="relative w-full">
          <input type="text" id="search-input" placeholder="搜索提示词..." 
                 class="w-full py-2 pl-10 pr-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary">
          <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
      </div>
      
      <!-- 操作按钮 -->
      <div class="flex items-center space-x-4">
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
          <i class="fa fa-moon-o dark:hidden"></i>
          <i class="fa fa-sun-o hidden dark:block text-yellow-400"></i>
        </button>
        <button id="add-prompt-btn" class="hidden md:flex items-center space-x-1 bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
          <i class="fa fa-plus"></i>
          <span>新建提示词</span>
        </button>
        <button id="mobile-menu-btn" class="md:hidden p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
          <i class="fa fa-bars"></i>
        </button>
      </div>
    </div>
    
    <!-- 移动端搜索框 -->
    <div class="md:hidden px-4 pb-3">
      <div class="relative w-full">
        <input type="text" id="mobile-search-input" placeholder="搜索提示词..." 
               class="w-full py-2 pl-10 pr-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary">
        <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
      </div>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="flex-1 container mx-auto px-4 py-6 flex flex-col md:flex-row overflow-hidden" style="max-height: calc(100vh - 140px);">
    <!-- 侧边栏 -->
    <aside id="sidebar" class="w-full md:w-64 lg:w-72 md:mr-6 mb-6 md:mb-0 overflow-y-auto" style="max-height: calc(100vh - 180px);">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-4">
        <!-- 移动端新建按钮 -->
        <button id="mobile-add-prompt-btn" class="md:hidden w-full mb-4 flex items-center justify-center space-x-1 bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
          <i class="fa fa-plus"></i>
          <span>新建提示词</span>
        </button>
        
        <!-- 分类标题 -->
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold">提示词分类</h2>
          <button id="add-category-btn" class="text-primary hover:text-blue-600">
            <i class="fa fa-plus-circle"></i>
          </button>
        </div>
        
        <!-- 分类列表 -->
        <ul id="category-list" class="space-y-1 mb-6">
          <!-- 分类项将通过JS动态生成 -->
        </ul>
        
        <!-- AI工具速达区域（简化版） -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">AI工具速达</h2>
            <div class="flex space-x-2">
              <button id="edit-ai-links" class="text-sm text-primary hover:text-blue-600" title="编辑链接">
                <i class="fa fa-pencil"></i>
              </button>
              <button id="add-ai-link" class="text-sm text-primary hover:text-blue-600" title="添加链接">
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
          <ul id="ai-links-list" class="space-y-2">
            <!-- 链接项将通过JS动态生成 -->
          </ul>
        </div>
        
        <!-- 快速操作 -->
        <div class="space-y-3">
          <h2 class="text-lg font-semibold mb-2">快速操作</h2>
          <button id="quick-add-prompt" class="w-full flex items-center justify-center space-x-2 bg-gradient-to-r from-primary to-accent hover:opacity-90 text-white px-4 py-3 rounded-lg transition-all">
            <i class="fa fa-plus-circle"></i>
            <span>快速新建提示词</span>
          </button>
          <button id="export-data" class="w-full flex items-center justify-center space-x-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-3 rounded-lg transition-colors">
            <i class="fa fa-download"></i>
            <span>导出提示词</span>
          </button>
        </div>
      </div>
    </aside>
    
    <!-- 内容区 -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- 筛选和排序 -->
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 space-y-3 sm:space-y-0">
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-500 dark:text-gray-400">筛选:</span>
          <select id="filter-select" class="text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 px-3 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary">
            <option value="all">全部分类</option>
            <!-- 分类选项将通过JS动态生成 -->
          </select>
        </div>
        
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-500 dark:text-gray-400">排序:</span>
          <select id="sort-select" class="text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 px-3 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary">
            <option value="createdAt-desc">最新创建</option>
            <option value="createdAt-asc">最早创建</option>
            <option value="usageCount-desc">最多使用</option>
            <option value="usageCount-asc">最少使用</option>
            <option value="title-asc">标题 A-Z</option>
            <option value="title-desc">标题 Z-A</option>
          </select>
        </div>
      </div>
      
      <!-- 提示词卡片列表 -->
      <div id="prompts-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 overflow-y-auto flex-1" style="max-height: calc(100vh - 300px);">
        <!-- 提示词卡片将通过JS动态生成 -->
      </div>
      
      <!-- 空状态 -->
      <div id="empty-state" class="hidden flex flex-col items-center justify-center py-16 text-center">
        <div class="w-24 h-24 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-4">
          <i class="fa fa-search text-4xl text-gray-300 dark:text-gray-600"></i>
        </div>
        <h3 class="text-xl font-semibold mb-2">未找到提示词</h3>
        <p class="text-gray-500 dark:text-gray-400 max-w-md mb-6">尝试调整搜索条件或创建新的提示词</p>
        <button id="empty-add-prompt-btn" class="flex items-center space-x-1 bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
          <i class="fa fa-plus"></i>
          <span>新建提示词</span>
        </button>
      </div>
      
      <!-- 分页控件 -->
      <div id="pagination" class="mt-6 flex items-center justify-between border-t border-gray-200 dark:border-gray-700 pt-4">
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-500 dark:text-gray-400">每页显示:</span>
          <select id="items-per-page" class="text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 px-3 py-1.5 focus:outline-none focus:ring-1 focus:ring-primary">
            <option value="6">6个</option>
            <option value="12">12个</option>
            <option value="18">18个</option>
            <option value="24">24个</option>
          </select>
        </div>
        
        <div class="flex items-center space-x-2">
          <button id="first-page" class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="fa fa-angle-double-left"></i>
          </button>
          <button id="prev-page" class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="fa fa-angle-left"></i>
          </button>
          
          <div class="flex items-center space-x-1">
            <span id="current-page" class="px-3 py-1 bg-primary text-white rounded-md">1</span>
            <span class="text-gray-500 dark:text-gray-400">/</span>
            <span id="total-pages" class="px-3 py-1 text-gray-700 dark:text-gray-300">1</span>
          </div>
          
          <button id="next-page" class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="fa fa-angle-right"></i>
          </button>
          <button id="last-page" class="p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed">
            <i class="fa fa-angle-double-right"></i>
          </button>
        </div>
        
        <div class="text-sm text-gray-500 dark:text-gray-400">
          共 <span id="total-items">0</span> 个提示词
        </div>
      </div>
    </div>
  </main>

  <!-- 提示词详情模态框 - 修改版 -->
  <div id="prompt-detail-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="absolute inset-0 overflow-y-auto py-6 px-4">
      <div class="min-h-full flex items-center justify-center">
        <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-4xl mx-auto slide-up" style="max-height: 80vh;">
          <!-- 外部关闭按钮 - 红色，在框外右上角 -->
          <button id="close-detail-modal" class="absolute -top-2 -right-2 w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center z-10 shadow-lg transition-colors">
            <i class="fa fa-times text-sm"></i>
          </button>
          
          <!-- 详情页头部 -->
          <div class="border-b border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between">
              <div>
                <h2 id="detail-title" class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2"></h2>
                <div class="flex items-center space-x-4">
                  <div class="flex items-center space-x-2">
                    <span id="detail-category" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"></span>
                    <span id="detail-usage" class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
                      <i class="fa fa-eye mr-1"></i>
                      <span id="usage-count">0</span>次使用
                    </span>
                  </div>
                  <div id="detail-tags" class="flex flex-wrap gap-2">
                    <!-- 标签将通过JS动态生成 -->
                  </div>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <button id="detail-copy-btn" class="flex items-center space-x-1 bg-primary hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                  <i class="fa fa-clipboard"></i>
                  <span>复制提示词</span>
                </button>
                <button id="detail-edit-btn" class="flex items-center space-x-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg transition-colors">
                  <i class="fa fa-pencil"></i>
                  <span>编辑</span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- 详情页内容 - 添加滚动限制 -->
          <div class="p-6 overflow-y-auto" style="max-height: calc(80vh - 140px);">
            <!-- 描述区域 -->
            <div class="mb-8">
              <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">描述</h3>
              <p id="detail-description" class="text-gray-600 dark:text-gray-400"></p>
            </div>
            
            <!-- 图片预览区域（如果有图片） -->
            <div id="detail-image-container" class="mb-8 hidden">
              <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3">参考图片</h3>
              <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-2">
                <img id="detail-image" src="" alt="参考图片" class="w-full max-h-64 object-contain rounded-md">
              </div>
            </div>
            
            <!-- 提示词内容区域 -->
            <div>
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300">提示词内容</h3>
                <button id="detail-copy-content-btn" class="text-sm text-primary hover:text-blue-600">
                  <i class="fa fa-clipboard mr-1"></i>复制内容
                </button>
              </div>
              <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-5">
                <pre id="detail-content" class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap font-mono text-sm leading-relaxed overflow-x-auto"></pre>
              </div>
            </div>
            
            <!-- 元数据 -->
            <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">创建时间</h4>
                  <p id="detail-created-at" class="text-gray-700 dark:text-gray-300"></p>
                </div>
                <div>
                  <h4 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">更新时间</h4>
                  <p id="detail-updated-at" class="text-gray-700 dark:text-gray-300"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 新建/编辑提示词模态框 -->
  <div id="prompt-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-lg mx-4">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 slide-in">
        <div class="flex items-center justify-between mb-6">
          <h2 id="prompt-modal-title" class="text-xl font-bold">新建提示词</h2>
          <button id="close-prompt-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
        
        <form id="prompt-form">
          <input type="hidden" id="prompt-id">
          
          <div class="mb-4">
            <label for="prompt-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">标题</label>
            <input type="text" id="prompt-title" required
                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
          
          <div class="mb-4">
            <label for="prompt-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">描述</label>
            <textarea id="prompt-description" rows="2"
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
          </div>
          
          <div class="mb-4">
            <label for="prompt-content" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">提示词内容</label>
            <textarea id="prompt-content" rows="4" required
                      class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary font-mono text-sm"></textarea>
          </div>
          
          <!-- 图片上传功能 -->
          <div class="mb-4">
            <label for="prompt-image" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">参考图片（可选）</label>
            <div class="flex items-center space-x-2">
              <input type="file" id="prompt-image" accept="image/*" 
                     class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
              <button type="button" id="clear-image-btn" class="hidden px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600">
                <i class="fa fa-times"></i>
              </button>
            </div>
            <div id="image-preview" class="mt-2 hidden">
              <div class="relative inline-block">
                <img id="preview-image" src="" alt="图片预览" class="max-h-48 rounded-lg">
                <button type="button" id="remove-preview-btn" class="absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center">
                  <i class="fa fa-times text-xs"></i>
                </button>
              </div>
            </div>
            <input type="hidden" id="prompt-image-data">
          </div>
          
          <div class="mb-4">
            <label for="prompt-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">分类</label>
            <select id="prompt-category" required
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
              <!-- 分类选项将通过JS动态生成 -->
            </select>
          </div>
          
          <div class="mb-6">
            <label for="prompt-tags" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">标签</label>
            <input type="text" id="prompt-tags" placeholder="输入标签，用逗号分隔"
                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
          
          <div class="flex justify-end space-x-3">
            <button type="button" id="cancel-prompt-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              取消
            </button>
            <button type="submit" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-md">
              保存
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 新建/编辑分类模态框 -->
  <div id="category-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md mx-4">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 slide-in">
        <div class="flex items-center justify-between mb-6">
          <h2 id="category-modal-title" class="text-xl font-bold">新建分类</h2>
          <button id="close-category-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
        
        <form id="category-form">
          <input type="hidden" id="category-id">
          
          <div class="mb-4">
            <label for="category-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">分类名称</label>
            <input type="text" id="category-name" required
                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
          
          <div class="mb-4">
            <label for="category-color" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">颜色</label>
            <div class="grid grid-cols-6 gap-2">
              <button type="button" class="color-option w-8 h-8 rounded-full bg-blue-500 ring-2 ring-offset-2 ring-blue-500" data-color="#3b82f6"></button>
              <button type="button" class="color-option w-8 h-8 rounded-full bg-green-500" data-color="#22c55e"></button>
              <button type="button" class="color-option w-8 h-8 rounded-full bg-yellow-500" data-color="#eab308"></button>
              <button type="button" class="color-option w-8 h-8 rounded-full bg-red-500" data-color="#ef4444"></button>
              <button type="button" class="color-option w-8 h-8 rounded-full bg-purple-500" data-color="#a855f7"></button>
              <button type="button" class="color-option w-8 h-8 rounded-full bg-gray-500" data-color="#6b7280"></button>
            </div>
            <input type="hidden" id="category-color" value="#3b82f6" required>
          </div>
          
          <div class="mb-6">
            <label for="category-icon" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">图标</label>
            <div class="grid grid-cols-8 gap-2">
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700 ring-2 ring-offset-2 ring-primary" data-icon="fa-lightbulb-o">
                <i class="fa fa-lightbulb-o"></i>
              </button>
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700" data-icon="fa-image">
                <i class="fa fa-image"></i>
              </button>
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700" data-icon="fa-file-text-o">
                <i class="fa fa-file-text-o"></i>
              </button>
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700" data-icon="fa-code">
                <i class="fa fa-code"></i>
              </button>
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700" data-icon="fa-music">
                <i class="fa fa-music"></i>
              </button>
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700" data-icon="fa-video-camera">
                <i class="fa fa-video-camera"></i>
              </button>
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700" data-icon="fa-gamepad">
                <i class="fa fa-gamepad"></i>
              </button>
              <button type="button" class="icon-option w-8 h-8 rounded flex items-center justify-center bg-gray-100 dark:bg-gray-700" data-icon="fa-ellipsis-h">
                <i class="fa fa-ellipsis-h"></i>
              </button>
            </div>
            <input type="hidden" id="category-icon" value="fa-lightbulb-o" required>
          </div>
          
          <div class="flex justify-end space-x-3">
            <button type="button" id="cancel-category-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              取消
            </button>
            <button type="submit" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-md">
              保存
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- AI链接编辑模态框 -->
  <div id="ai-link-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md mx-4">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 slide-in">
        <div class="flex items-center justify-between mb-6">
          <h2 id="ai-link-modal-title" class="text-xl font-bold">添加AI网站链接</h2>
          <button id="close-ai-link-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
        
        <form id="ai-link-form">
          <input type="hidden" id="ai-link-id">
          
          <div class="mb-4">
            <label for="ai-link-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">网站名称</label>
            <input type="text" id="ai-link-name" required
                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
          
          <div class="mb-6">
            <label for="ai-link-url" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">网站URL</label>
            <input type="url" id="ai-link-url" required placeholder="https://example.com"
                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
          </div>
          
          <div class="flex justify-end space-x-3">
            <button type="button" id="cancel-ai-link-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
              取消
            </button>
            <button type="submit" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-md">
              保存
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 导出选项模态框 -->
  <div id="export-options-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md mx-4">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 slide-in">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-bold">导出选项</h2>
          <button id="close-export-options-modal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
        
        <div class="space-y-4 mb-6">
          <p class="text-gray-600 dark:text-gray-400">选择导出格式：</p>
          
          <div class="space-y-3">
            <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
              <input type="radio" name="export-format" value="structured" class="mr-3" checked>
              <div>
                <div class="font-medium">结构化导出（推荐）</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">每个提示词一个文件夹，包含TXT和图片</div>
              </div>
            </label>
            
            <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
              <input type="radio" name="export-format" value="simple-txt" class="mr-3">
              <div>
                <div class="font-medium">简单TXT导出</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">所有提示词合并为一个TXT文件</div>
              </div>
            </label>
            
            <label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
              <input type="radio" name="export-format" value="json" class="mr-3">
              <div>
                <div class="font-medium">JSON导出（完整数据）</div>
                <div class="text-sm text-gray-500 dark:text-gray-400">导出所有数据，用于备份或迁移</div>
              </div>
            </label>
          </div>
        </div>
        
        <!-- 结构化导出选项 -->
        <div id="structured-options" class="space-y-4 mb-6">
          <div>
            <label class="flex items-center space-x-2">
              <input type="checkbox" id="include-images" class="rounded" checked>
              <span>包含图片</span>
            </label>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">文件名格式</label>
            <select id="filename-format" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary">
              <option value="title">使用提示词标题</option>
              <option value="id-title">ID + 标题</option>
              <option value="timestamp">时间戳 + 标题</option>
            </select>
          </div>
        </div>
        
        <div class="flex justify-end space-x-3">
          <button id="cancel-export-options-btn" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
            取消
          </button>
          <button id="confirm-export-btn" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-md">
            开始导出
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 导出进度模态框 -->
  <div id="export-progress-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md mx-4">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 slide-in">
        <div class="flex flex-col items-center justify-center">
          <div class="loading-spinner mb-4"></div>
          <h3 class="text-xl font-bold mb-2">正在导出数据...</h3>
          <p id="export-progress-text" class="text-gray-600 dark:text-gray-400 text-center mb-4">
            正在准备导出文件，请稍候...
          </p>
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-2">
            <div id="export-progress-bar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
          </div>
          <p id="export-status" class="text-sm text-gray-500 dark:text-gray-400">0 / 0</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 复制成功提示 -->
  <div id="copy-notification" class="fixed bottom-4 right-4 bg-success text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center space-x-2">
    <i class="fa fa-check-circle"></i>
    <span>提示词已复制到剪贴板</span>
  </div>

  <!-- 底部制作者信息 -->
  <footer class="py-4 text-center text-white text-sm border-t border-gray-800" style="background-color: #2e2e2e;">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row items-center justify-between">
        <div class="mb-2 md:mb-0">
          Page creator: By LuBing
        </div>
        <div class="flex items-center space-x-4">
          <span class="text-gray-400 text-xs">AI提示词助手 v1.1</span>
          <span class="text-gray-400 text-xs hidden md:inline">•</span>
          <span class="text-gray-400 text-xs hidden md:inline">提升您的AI创作效率</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    // 数据存储
    let prompts = [];
    let categories = [];
    let currentDetailPrompt = null;
    
    // 新增：AI网站数据
    let aiWebsites = [
      { id: '1', name: '豆包', url: 'https://www.doubao.com/' },
      { id: '2', name: '即梦', url: 'https://jimeng.jianying.com/ai-tool/home' },
      { id: '3', name: '哩布', url: 'https://www.liblib.art/' },
      { id: '4', name: '可灵', url: 'https://app.klingai.com/cn/' }
    ];
    
    // 分页相关变量
    let currentPage = 1;
    let itemsPerPage = 6;
    let isEditingAiLinks = false;
    
    // DOM 元素
    const promptsContainer = document.getElementById('prompts-container');
    const categoryList = document.getElementById('category-list');
    const filterSelect = document.getElementById('filter-select');
    const promptCategorySelect = document.getElementById('prompt-category');
    const searchInput = document.getElementById('search-input');
    const mobileSearchInput = document.getElementById('mobile-search-input');
    const sortSelect = document.getElementById('sort-select');
    const emptyState = document.getElementById('empty-state');
    
    // AI链接相关元素
    const aiLinksList = document.getElementById('ai-links-list');
    const editAiLinksBtn = document.getElementById('edit-ai-links');
    const addAiLinkBtn = document.getElementById('add-ai-link');
    
    // 分页相关元素
    const pagination = document.getElementById('pagination');
    const itemsPerPageSelect = document.getElementById('items-per-page');
    const firstPageBtn = document.getElementById('first-page');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    const lastPageBtn = document.getElementById('last-page');
    const currentPageSpan = document.getElementById('current-page');
    const totalPagesSpan = document.getElementById('total-pages');
    const totalItemsSpan = document.getElementById('total-items');
    
    // 模态框元素
    const promptModal = document.getElementById('prompt-modal');
    const categoryModal = document.getElementById('category-modal');
    const aiLinkModal = document.getElementById('ai-link-modal');
    const exportOptionsModal = document.getElementById('export-options-modal');
    const exportProgressModal = document.getElementById('export-progress-modal');
    const promptDetailModal = document.getElementById('prompt-detail-modal');
    const promptModalTitle = document.getElementById('prompt-modal-title');
    const categoryModalTitle = document.getElementById('category-modal-title');
    const aiLinkModalTitle = document.getElementById('ai-link-modal-title');
    const promptForm = document.getElementById('prompt-form');
    const categoryForm = document.getElementById('category-form');
    const aiLinkForm = document.getElementById('ai-link-form');
    
    // 详情页元素
    const detailTitle = document.getElementById('detail-title');
    const detailDescription = document.getElementById('detail-description');
    const detailContent = document.getElementById('detail-content');
    const detailCategory = document.getElementById('detail-category');
    const detailTags = document.getElementById('detail-tags');
    const detailImageContainer = document.getElementById('detail-image-container');
    const detailImage = document.getElementById('detail-image');
    const detailCreatedAt = document.getElementById('detail-created-at');
    const detailUpdatedAt = document.getElementById('detail-updated-at');
    const usageCount = document.getElementById('usage-count');
    const detailCopyBtn = document.getElementById('detail-copy-btn');
    const detailEditBtn = document.getElementById('detail-edit-btn');
    const detailCopyContentBtn = document.getElementById('detail-copy-content-btn');
    const closeDetailModal = document.getElementById('close-detail-modal');
    
    // 导出进度元素
    const exportProgressText = document.getElementById('export-progress-text');
    const exportProgressBar = document.getElementById('export-progress-bar');
    const exportStatus = document.getElementById('export-status');
    
    // 图片上传相关元素
    const promptImageInput = document.getElementById('prompt-image');
    const imagePreview = document.getElementById('image-preview');
    const previewImage = document.getElementById('preview-image');
    const removePreviewBtn = document.getElementById('remove-preview-btn');
    const clearImageBtn = document.getElementById('clear-image-btn');
    const promptImageData = document.getElementById('prompt-image-data');
    
    // 按钮元素
    const addPromptBtn = document.getElementById('add-prompt-btn');
    const mobileAddPromptBtn = document.getElementById('mobile-add-prompt-btn');
    const emptyAddPromptBtn = document.getElementById('empty-add-prompt-btn');
    const addCategoryBtn = document.getElementById('add-category-btn');
    const closePromptModal = document.getElementById('close-prompt-modal');
    const closeCategoryModal = document.getElementById('close-category-modal');
    const closeAiLinkModal = document.getElementById('close-ai-link-modal');
    const closeExportOptionsModal = document.getElementById('close-export-options-modal');
    const cancelPromptBtn = document.getElementById('cancel-prompt-btn');
    const cancelCategoryBtn = document.getElementById('cancel-category-btn');
    const cancelAiLinkBtn = document.getElementById('cancel-ai-link-btn');
    const cancelExportOptionsBtn = document.getElementById('cancel-export-options-btn');
    const confirmExportBtn = document.getElementById('confirm-export-btn');
    const themeToggle = document.getElementById('theme-toggle');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const quickAddPromptBtn = document.getElementById('quick-add-prompt');
    const exportDataBtn = document.getElementById('export-data');
    
    // 导出选项元素
    const includeImagesCheckbox = document.getElementById('include-images');
    const filenameFormatSelect = document.getElementById('filename-format');
    
    // 通知元素
    const copyNotification = document.getElementById('copy-notification');
    
    // 初始化应用
    function initApp() {
      // 加载数据
      loadData();
      
      // 渲染初始数据
      renderCategories();
      renderPrompts();
      renderAiLinks();
      
      // 设置事件监听器
      setupEventListeners();
      
      // 检查主题偏好
      checkThemePreference();
      
      // 初始化分页
      updatePagination();
    }
    
    // 加载数据
    function loadData() {
      // 从 localStorage 加载数据
      const savedPrompts = localStorage.getItem('ai-prompt-assistant-prompts');
      const savedCategories = localStorage.getItem('ai-prompt-assistant-categories');
      const savedAiWebsites = localStorage.getItem('ai-prompt-assistant-ai-websites');
      
      // 如果有保存的数据，则加载它
      if (savedPrompts) {
        prompts = JSON.parse(savedPrompts);
      } else {
        // 否则使用默认数据
        prompts = getDefaultPrompts();
        savePrompts();
      }
      
      if (savedCategories) {
        categories = JSON.parse(savedCategories);
      } else {
        categories = getDefaultCategories();
        saveCategories();
      }
      
      if (savedAiWebsites) {
        aiWebsites = JSON.parse(savedAiWebsites);
      } else {
        // 使用默认AI网站数据
        saveAiWebsites();
      }
    }
    
    // 获取默认提示词
    function getDefaultPrompts() {
      return [
        {
          id: '1',
          title: '生成高质量图像描述',
          description: '用于生成详细、生动的图像描述提示词，适用于各种AI图像生成工具，如Midjourney、DALL-E、Stable Diffusion等。此提示词模板可以帮助您创建具有丰富细节、特定风格和情感氛围的图像。',
          content: '请生成一张[主题]的高质量图像，具有[风格]风格，包含[元素1]、[元素2]和[元素3]。图像应该有[光线]照明，[构图]构图，以及[细节]细节。整体氛围应该是[氛围]。\n\n可替换参数说明：\n- [主题]: 图像的主要主题，如"森林中的小屋"、"未来城市"等\n- [风格]: 艺术风格，如"写实主义"、"印象派"、"赛博朋克"等\n- [元素1-3]: 图像中应包含的具体元素\n- [光线]: 照明类型，如"自然光"、"戏剧性灯光"、"柔和散射光"等\n- [构图]: 构图方式，如"对称构图"、"三分法"、"引导线构图"等\n- [细节]: 细节水平，如"高度细节"、"精致纹理"等\n- [氛围]: 整体情感氛围，如"神秘"、"宁静"、"激动人心"等',
          categoryId: '1',
          tags: ['图像生成', '创意', '设计', 'AI绘画'],
          usageCount: 15,
          createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
          image: ''
        },
        {
          id: '2',
          title: '撰写专业邮件',
          description: '用于生成正式、专业的电子邮件模板，适用于商务沟通、客户服务、工作汇报等场景。此模板可以帮助您快速构建结构清晰、语气得体的邮件内容。',
          content: '请帮我撰写一封关于[主题]的专业电子邮件。邮件应该包含以下部分：\n1. 简短的问候语\n2. 清晰的主题说明\n3. [详细内容要点]\n4. 明确的下一步行动或请求\n5. 礼貌的结束语\n\n邮件风格应该专业但友好，语言简洁明了。\n\n可替换参数说明：\n- [主题]: 邮件的核心主题，如"项目进度汇报"、"客户反馈处理"等\n- [详细内容要点]: 邮件的核心内容，可按需调整具体要点数量',
          categoryId: '2',
          tags: ['写作', '职场', '沟通', '商务'],
          usageCount: 8,
          createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
          image: ''
        },
        {
          id: '3',
          title: '代码优化建议',
          description: '用于获取代码优化和改进建议，适用于各种编程语言和开发场景。此提示词可以帮助您提高代码性能、可读性和可维护性。',
          content: '请分析以下代码并提供优化建议：\n```[编程语言]\n[代码内容]\n```\n\n请关注以下方面：\n1. 性能优化机会\n2. 代码可读性改进\n3. 潜在的错误或边缘情况\n4. 最佳实践建议\n5. 可能的重构方案\n\n请提供具体的改进建议和优化后的代码示例。\n\n可替换参数说明：\n- [编程语言]: 代码使用的编程语言，如"Python"、"JavaScript"、"Java"等\n- [代码内容]: 需要优化的具体代码',
          categoryId: '3',
          tags: ['编程', '开发', '优化', '代码审查'],
          usageCount: 12,
          createdAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
          image: ''
        },
        {
          id: '4',
          title: '创意写作灵感',
          description: '用于获取创意写作的灵感和方向，适用于小说、诗歌、剧本等创作场景。此提示词可以帮助您突破创作瓶颈，找到新的创作角度。',
          content: '请为一篇关于[主题]的创意写作提供灵感。包括：\n1. 3-5个独特的角度或切入点\n2. 可能的角色或人物原型\n3. 引人入胜的开头场景建议\n4. 潜在的冲突或转折点\n5. 主题或信息的深层探索\n\n风格应该是[风格]，目标读者是[读者群体]。\n\n可替换参数说明：\n- [主题]: 创作的核心主题，如"时间旅行"、"人工智能伦理"等\n- [风格]: 写作风格，如"悬疑"、"浪漫"、"科幻"等\n- [读者群体]: 目标读者，如"青少年"、"成人读者"等',
          categoryId: '4',
          tags: ['写作', '创意', '灵感', '文学创作'],
          usageCount: 6,
          createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
          image: ''
        },
        {
          id: '5',
          title: '产品描述生成',
          description: '用于创建吸引人的产品描述，适用于电商平台、营销材料等场景。此模板可以帮助您突出产品特点，提高转化率。',
          content: '请为[产品名称]创建一个引人入胜的产品描述。产品是[产品类型]，主要特点包括[特点1]、[特点2]和[特点3]。目标受众是[目标受众]。\n\n描述应包括：\n1. 引人注目的标题\n2. 产品概述\n3. 详细的特点和优势\n4. 解决的问题或提供的价值\n5. 号召性用语\n\n整体语调应该[语调]，突出产品的[独特卖点]。\n\n可替换参数说明：\n- [产品名称]: 产品的具体名称\n- [产品类型]: 产品类别，如"智能手表"、"有机护肤品"等\n- [特点1-3]: 产品的核心特点和优势\n- [目标受众]: 产品的目标客户群体\n- [语调]: 描述的语气，如"专业"、"亲切"、"激情"等\n- [独特卖点]: 产品最独特的销售主张',
          categoryId: '5',
          tags: ['营销', '写作', '产品', '电商'],
          usageCount: 9,
          createdAt: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
          image: ''
        },
        {
          id: '6',
          title: '学习计划制定',
          description: '用于创建结构化的学习计划，适用于个人学习、教育培训等场景。此模板可以帮助您规划学习路径，提高学习效率。',
          content: '请为学习[主题]创建一个为期[时间长度]的结构化学习计划。学习者具有[现有知识水平]水平的知识，目标是[学习目标]。\n\n计划应包括：\n1. 总体学习路径和里程碑\n2. 每周学习主题和资源\n3. 实践活动和项目建议\n4. 自我评估方法\n5. 常见挑战和克服策略\n\n学习资源应包括各种类型，如[资源类型]。\n\n可替换参数说明：\n- [主题]: 学习的核心主题，如"Python编程"、"数字营销"等\n- [时间长度]: 学习计划的持续时间，如"3个月"、"6周"等\n- [现有知识水平]: 学习者的起点水平，如"初学者"、"中级"等\n- [学习目标]: 学习的具体目标，如"掌握基础语法"、"能够独立开发小型项目"等\n- [资源类型]: 推荐的学习资源类型，如"在线课程"、"书籍"、"实践项目"等',
          categoryId: '6',
          tags: ['教育', '学习', '计划', '自我提升'],
          usageCount: 4,
          createdAt: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 6 * 24 * 60 * 60 * 1000).toISOString(),
          image: ''
        }
      ];
    }
    
    // 获取默认分类
    function getDefaultCategories() {
      return [
        {
          id: '1',
          name: '图像生成',
          color: '#3b82f6',
          icon: 'fa-image',
          createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: '2',
          name: '职场沟通',
          color: '#22c55e',
          icon: 'fa-file-text-o',
          createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: '3',
          name: '编程开发',
          color: '#eab308',
          icon: 'fa-code',
          createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: '4',
          name: '创意写作',
          color: '#a855f7',
          icon: 'fa-lightbulb-o',
          createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: '5',
          name: '营销文案',
          color: '#ef4444',
          icon: 'fa-bullhorn',
          createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
          id: '6',
          name: '教育学习',
          color: '#6b7280',
          icon: 'fa-graduation-cap',
          createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
          updatedAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString()
        }
      ];
    }
    
    // 保存数据
    function savePrompts() {
      localStorage.setItem('ai-prompt-assistant-prompts', JSON.stringify(prompts));
    }
    
    function saveCategories() {
      localStorage.setItem('ai-prompt-assistant-categories', JSON.stringify(categories));
    }
    
    function saveAiWebsites() {
      localStorage.setItem('ai-prompt-assistant-ai-websites', JSON.stringify(aiWebsites));
    }
    
    // 渲染分类 - 优化后的版本，解决闪烁问题
    function renderCategories() {
      // 清空分类列表
      categoryList.innerHTML = '';
      
      // 添加"全部"分类
      const allCategoryItem = document.createElement('li');
      allCategoryItem.innerHTML = `
        <div class="flex items-center justify-between">
          <button class="category-item w-full flex items-center justify-between p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-left hover:bg-gray-200 dark:hover:bg-gray-600" data-category-id="all">
            <div class="flex items-center space-x-2">
              <div class="w-8 h-8 rounded-full bg-gray-500 flex items-center justify-center text-white">
                <i class="fa fa-th-large"></i>
              </div>
              <span>全部</span>
            </div>
            <span class="bg-gray-300 dark:bg-gray-500 text-xs px-2 py-0.5 rounded-full min-w-8 text-center">${prompts.length}</span>
          </button>
        </div>
      `;
      categoryList.appendChild(allCategoryItem);
      
      // 添加各个分类
      categories.forEach(category => {
        const promptCount = prompts.filter(prompt => prompt.categoryId === category.id).length;
        
        const categoryItem = document.createElement('li');
        categoryItem.className = 'category-list-item';
        categoryItem.innerHTML = `
          <div class="flex items-center justify-between group">
            <button class="category-item w-full flex items-center justify-between p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-left" data-category-id="${category.id}">
              <div class="flex items-center space-x-2">
                <div class="w-8 h-8 rounded-full flex-shrink-0" style="background-color: ${category.color}">
                  <i class="fa ${category.icon} w-full h-full flex items-center justify-center text-white"></i>
                </div>
                <span class="truncate">${category.name}</span>
              </div>
              <span class="bg-gray-200 dark:bg-gray-600 text-xs px-2 py-0.5 rounded-full min-w-8 text-center">${promptCount}</span>
            </button>
            
            <!-- 操作按钮容器 - 使用绝对定位避免布局变化 -->
            <div class="relative">
              <button class="category-action-btn p-1.5 rounded-md hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors" data-category-id="${category.id}">
                <i class="fa fa-ellipsis-v"></i>
              </button>
              
              <!-- 下拉菜单 -->
              <div class="category-action-menu hidden absolute right-0 mt-1 w-36 bg-white dark:bg-gray-800 rounded-lg shadow-lg z-10 border border-gray-200 dark:border-gray-700">
                <button class="edit-category-btn w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300" data-category-id="${category.id}">
                  <i class="fa fa-pencil mr-2"></i>编辑分类
                </button>
                <button class="delete-category-btn w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-danger" data-category-id="${category.id}">
                  <i class="fa fa-trash mr-2"></i>删除分类
                </button>
              </div>
            </div>
          </div>
        `;
        categoryList.appendChild(categoryItem);
        
        // 添加分类点击事件
        const categoryButton = categoryItem.querySelector('.category-item');
        const actionButton = categoryItem.querySelector('.category-action-btn');
        const actionMenu = categoryItem.querySelector('.category-action-menu');
        
        // 分类项点击事件 - 筛选提示词
        categoryButton.addEventListener('click', (e) => {
          // 只有当点击的不是操作按钮时才执行筛选
          if (!e.target.closest('.category-action-btn') && !e.target.closest('.category-action-menu')) {
            const categoryId = categoryButton.dataset.categoryId;
            filterSelect.value = categoryId;
            currentPage = 1;
            renderPrompts();
          }
        });
        
        // 操作按钮点击事件 - 显示/隐藏下拉菜单
        actionButton.addEventListener('click', (e) => {
          e.stopPropagation(); // 阻止事件冒泡，避免触发分类点击事件
          
          // 关闭其他打开的下拉菜单
          document.querySelectorAll('.category-action-menu').forEach(menu => {
            if (menu !== actionMenu) {
              menu.classList.add('hidden');
            }
          });
          
          // 切换当前下拉菜单的显示状态
          actionMenu.classList.toggle('hidden');
        });
      });
      
      // 点击页面其他地方关闭所有分类操作菜单
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.category-action-btn') && !e.target.closest('.category-action-menu')) {
          document.querySelectorAll('.category-action-menu').forEach(menu => {
            menu.classList.add('hidden');
          });
        }
      });
      
      // 更新分类选择器
      updateCategorySelects();
    }
    
    // 更新分类选择器
    function updateCategorySelects() {
      // 清空选择器
      filterSelect.innerHTML = '<option value="all">全部分类</option>';
      promptCategorySelect.innerHTML = '';
      
      // 添加分类选项
      categories.forEach(category => {
        const filterOption = document.createElement('option');
        filterOption.value = category.id;
        filterOption.textContent = category.name;
        filterSelect.appendChild(filterOption);
        
        const promptOption = document.createElement('option');
        promptOption.value = category.id;
        promptOption.textContent = category.name;
        promptCategorySelect.appendChild(promptOption);
      });
    }
    
    // 渲染提示词
    function renderPrompts() {
      // 获取筛选和排序值
      const filterValue = filterSelect.value;
      const sortValue = sortSelect.value;
      const searchValue = searchInput.value.toLowerCase() || mobileSearchInput.value.toLowerCase();
      
      // 筛选提示词
      let filteredPrompts = prompts;
      
      // 应用分类筛选
      if (filterValue !== 'all') {
        filteredPrompts = filteredPrompts.filter(prompt => prompt.categoryId === filterValue);
      }
      
      // 应用搜索筛选
      if (searchValue) {
        filteredPrompts = filteredPrompts.filter(prompt => 
          prompt.title.toLowerCase().includes(searchValue) || 
          prompt.description.toLowerCase().includes(searchValue) ||
          (prompt.tags && prompt.tags.some(tag => tag.toLowerCase().includes(searchValue)))
        );
      }
      
      // 应用排序
      const [sortField, sortOrder] = sortValue.split('-');
      
      filteredPrompts.sort((a, b) => {
        let aValue = a[sortField];
        let bValue = b[sortField];
        
        // 处理日期类型
        if (sortField === 'createdAt' || sortField === 'updatedAt') {
          aValue = new Date(aValue).getTime();
          bValue = new Date(bValue).getTime();
        }
        
        // 处理字符串类型
        if (typeof aValue === 'string') {
          aValue = aValue.toLowerCase();
          bValue = bValue.toLowerCase();
        }
        
        // 应用排序顺序
        if (sortOrder === 'asc') {
          return aValue > bValue ? 1 : -1;
        } else {
          return aValue < bValue ? 1 : -1;
        }
      });
      
      // 清空提示词容器
      promptsContainer.innerHTML = '';
      
      // 计算分页
      const totalItems = filteredPrompts.length;
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      
      // 确保当前页在有效范围内
      if (currentPage > totalPages && totalPages > 0) {
        currentPage = totalPages;
      }
      if (currentPage < 1 && totalPages > 0) {
        currentPage = 1;
      }
      
      // 获取当前页的数据
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
      const currentPagePrompts = filteredPrompts.slice(startIndex, endIndex);
      
      // 检查是否有提示词
      if (currentPagePrompts.length === 0) {
        emptyState.classList.remove('hidden');
        promptsContainer.classList.add('hidden');
        pagination.classList.add('hidden');
      } else {
        emptyState.classList.add('hidden');
        promptsContainer.classList.remove('hidden');
        pagination.classList.remove('hidden');
      }
      
      // 更新分页信息
      updatePaginationInfo(totalItems, totalPages);
      
      // 渲染提示词卡片
      currentPagePrompts.forEach(prompt => {
        const category = categories.find(c => c.id === prompt.categoryId);
        
        const promptCard = document.createElement('div');
        promptCard.className = 'bg-white dark:bg-gray-800 rounded-xl shadow-card hover:shadow-card-hover card-transition fade-in cursor-pointer prompt-card';
        promptCard.dataset.promptId = prompt.id;
        promptCard.innerHTML = `
          <div class="p-5">
            <div class="flex items-start justify-between mb-3">
              <h3 class="text-lg font-semibold line-clamp-1">${prompt.title}</h3>
              <div class="relative">
                <button class="prompt-actions-btn p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                  <i class="fa fa-ellipsis-v"></i>
                </button>
                <div class="prompt-actions hidden absolute right-0 mt-1 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-10 border border-gray-200 dark:border-gray-700">
                  <button class="view-prompt-detail-btn w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300" data-prompt-id="${prompt.id}">
                    <i class="fa fa-eye mr-2"></i>查看详情
                  </button>
                  <button class="edit-prompt-btn w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300" data-prompt-id="${prompt.id}">
                    <i class="fa fa-pencil mr-2"></i>编辑
                  </button>
                  <button class="delete-prompt-btn w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 text-danger" data-prompt-id="${prompt.id}">
                    <i class="fa fa-trash mr-2"></i>删除
                  </button>
                </div>
              </div>
            </div>
            
            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4 line-clamp-2">${prompt.description}</p>
            
            <!-- 图片预览 -->
            ${prompt.image ? `
              <div class="mb-4">
                <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-1">
                  <img src="${prompt.image}" alt="参考图片" class="w-full h-40 object-cover rounded-md">
                </div>
              </div>
            ` : ''}
            
            <div class="mb-4">
              <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-3 font-mono text-xs text-gray-700 dark:text-gray-300 overflow-x-auto">
                ${escapeHtml(prompt.content).substring(0, 150)}${prompt.content.length > 150 ? '...' : ''}
              </div>
            </div>
            
            ${prompt.tags && prompt.tags.length > 0 ? `
              <div class="flex flex-wrap gap-2 mb-4">
                ${prompt.tags.map(tag => `
                  <span class="bg-gray-100 dark:bg-gray-700 text-xs px-2 py-1 rounded-full">${tag}</span>
                `).join('')}
              </div>
            ` : ''}
            
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-2">
                <div class="w-6 h-6 rounded-full" style="background-color: ${category ? category.color : '#6b7280'}">
                  <i class="fa ${category ? category.icon : 'fa-folder'} w-full h-full flex items-center justify-center text-white text-xs"></i>
                </div>
                <span class="text-xs text-gray-500 dark:text-gray-400">${category ? category.name : '未分类'}</span>
              </div>
              
              <div class="flex items-center space-x-3">
                <div class="flex items-center space-x-1 text-xs text-gray-500 dark:text-gray-400">
                  <i class="fa fa-eye"></i>
                  <span>${prompt.usageCount || 0}</span>
                </div>
                
                <button class="copy-prompt-btn p-1.5 rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-600 dark:text-gray-300" data-prompt-id="${prompt.id}">
                  <i class="fa fa-clipboard"></i>
                </button>
              </div>
            </div>
          </div>
        `;
        
        promptsContainer.appendChild(promptCard);
        
        // 添加操作按钮事件
        const actionsBtn = promptCard.querySelector('.prompt-actions-btn');
        const actionsMenu = promptCard.querySelector('.prompt-actions');
        
        actionsBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          // 关闭其他提示词的操作菜单
          document.querySelectorAll('.prompt-actions').forEach(menu => {
            if (menu !== actionsMenu) {
              menu.classList.add('hidden');
            }
          });
          actionsMenu.classList.toggle('hidden');
        });
        
        // 点击其他地方关闭操作菜单
        document.addEventListener('click', (e) => {
          if (!promptCard.contains(e.target)) {
            actionsMenu.classList.add('hidden');
          }
        });
      });
    }
    
    // 渲染AI网站链接列表
    function renderAiLinks() {
      aiLinksList.innerHTML = ''; // 清空列表
      
      aiWebsites.forEach(site => {
        const listItem = document.createElement('li');
        
        listItem.innerHTML = `
          <div class="flex items-center justify-between p-3 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
            <a href="${site.url}" 
               target="_blank" 
               rel="noopener noreferrer"
               class="flex-1 no-underline group">
              <span class="font-medium text-gray-700 dark:text-gray-300 group-hover:text-primary">${site.name}</span>
              <span class="text-xs text-gray-500 dark:text-gray-400 block truncate">${new URL(site.url).hostname.replace('www.', '')}</span>
            </a>
            <!-- 操作按钮 -->
            ${isEditingAiLinks ? `
              <div class="flex space-x-1 ml-2">
                <button class="edit-ai-link-btn p-1 text-gray-400 hover:text-primary" data-ai-link-id="${site.id}" title="编辑">
                  <i class="fa fa-pencil"></i>
                </button>
                <button class="delete-ai-link-btn p-1 text-gray-400 hover:text-danger" data-ai-link-id="${site.id}" title="删除">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            ` : ''}
          </div>
        `;
        
        aiLinksList.appendChild(listItem);
      });
    }
    
    // 更新分页信息
    function updatePaginationInfo(totalItems, totalPages) {
      totalItemsSpan.textContent = totalItems;
      currentPageSpan.textContent = currentPage;
      totalPagesSpan.textContent = totalPages;
      
      // 更新按钮状态
      firstPageBtn.disabled = currentPage === 1;
      prevPageBtn.disabled = currentPage === 1;
      nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
      lastPageBtn.disabled = currentPage === totalPages || totalPages === 0;
      
      // 更新按钮样式
      firstPageBtn.classList.toggle('opacity-50', currentPage === 1);
      firstPageBtn.classList.toggle('cursor-not-allowed', currentPage === 1);
      prevPageBtn.classList.toggle('opacity-50', currentPage === 1);
      prevPageBtn.classList.toggle('cursor-not-allowed', currentPage === 1);
      nextPageBtn.classList.toggle('opacity-50', currentPage === totalPages || totalPages === 0);
      nextPageBtn.classList.toggle('cursor-not-allowed', currentPage === totalPages || totalPages === 0);
      lastPageBtn.classList.toggle('opacity-50', currentPage === totalPages || totalPages === 0);
      lastPageBtn.classList.toggle('cursor-not-allowed', currentPage === totalPages || totalPages === 0);
    }
    
    // 更新分页
    function updatePagination() {
      renderPrompts();
    }
    
    // 设置事件监听器
    function setupEventListeners() {
      // 新建提示词按钮
      addPromptBtn.addEventListener('click', () => openPromptModal());
      mobileAddPromptBtn.addEventListener('click', () => openPromptModal());
      emptyAddPromptBtn.addEventListener('click', () => openPromptModal());
      quickAddPromptBtn.addEventListener('click', () => openPromptModal());
      
      // 新建分类按钮
      addCategoryBtn.addEventListener('click', () => openCategoryModal());
      
      // 编辑AI链接按钮
      editAiLinksBtn.addEventListener('click', () => {
        isEditingAiLinks = !isEditingAiLinks;
        editAiLinksBtn.classList.toggle('text-primary', !isEditingAiLinks);
        editAiLinksBtn.classList.toggle('text-success', isEditingAiLinks);
        renderAiLinks();
      });
      
      // 添加AI链接按钮
      addAiLinkBtn.addEventListener('click', () => openAiLinkModal());
      
      // 导出数据按钮 - 打开导出选项模态框
      exportDataBtn.addEventListener('click', () => {
        openExportOptionsModal();
      });
      
      // 关闭模态框按钮
      closePromptModal.addEventListener('click', () => closeModal(promptModal));
      closeCategoryModal.addEventListener('click', () => closeModal(categoryModal));
      closeAiLinkModal.addEventListener('click', () => closeModal(aiLinkModal));
      closeExportOptionsModal.addEventListener('click', () => closeModal(exportOptionsModal));
      closeDetailModal.addEventListener('click', () => closeModal(promptDetailModal));
      cancelPromptBtn.addEventListener('click', () => closeModal(promptModal));
      cancelCategoryBtn.addEventListener('click', () => closeModal(categoryModal));
      cancelAiLinkBtn.addEventListener('click', () => closeModal(aiLinkModal));
      cancelExportOptionsBtn.addEventListener('click', () => closeModal(exportOptionsModal));
      
      // 详情页按钮事件
      detailCopyBtn.addEventListener('click', () => {
        if (currentDetailPrompt) {
          copyPrompt(currentDetailPrompt.id);
          closeModal(promptDetailModal);
        }
      });
      
      detailEditBtn.addEventListener('click', () => {
        if (currentDetailPrompt) {
          closeModal(promptDetailModal);
          openPromptModal(currentDetailPrompt.id);
        }
      });
      
      detailCopyContentBtn.addEventListener('click', () => {
        if (currentDetailPrompt) {
          navigator.clipboard.writeText(currentDetailPrompt.content)
            .then(() => {
              showCopyNotification();
              // 增加使用次数
              currentDetailPrompt.usageCount = (currentDetailPrompt.usageCount || 0) + 1;
              savePrompts();
              // 更新详情页中的使用次数
              usageCount.textContent = currentDetailPrompt.usageCount;
            })
            .catch(err => {
              console.error('复制失败:', err);
              alert('复制失败，请手动复制。');
            });
        }
      });
      
      // 确认导出按钮
      confirmExportBtn.addEventListener('click', () => {
        const format = document.querySelector('input[name="export-format"]:checked').value;
        
        switch(format) {
          case 'structured':
            exportPromptsStructured();
            break;
          case 'simple-txt':
            exportPromptsAsSimpleTxt();
            break;
          case 'json':
            exportDataAsJson();
            break;
        }
        
        closeModal(exportOptionsModal);
      });
      
      // 分页事件监听器
      itemsPerPageSelect.addEventListener('change', () => {
        itemsPerPage = parseInt(itemsPerPageSelect.value);
        currentPage = 1;
        updatePagination();
      });
      
      firstPageBtn.addEventListener('click', () => {
        currentPage = 1;
        updatePagination();
      });
      
      prevPageBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          updatePagination();
        }
      });
      
      nextPageBtn.addEventListener('click', () => {
        const filterValue = filterSelect.value;
        const searchValue = searchInput.value.toLowerCase() || mobileSearchInput.value.toLowerCase();
        
        let filteredPrompts = prompts;
        
        if (filterValue !== 'all') {
          filteredPrompts = filteredPrompts.filter(prompt => prompt.categoryId === filterValue);
        }
        
        if (searchValue) {
          filteredPrompts = filteredPrompts.filter(prompt => 
            prompt.title.toLowerCase().includes(searchValue) || 
            prompt.description.toLowerCase().includes(searchValue) ||
            (prompt.tags && prompt.tags.some(tag => tag.toLowerCase().includes(searchValue)))
          );
        }
        
        const totalPages = Math.ceil(filteredPrompts.length / itemsPerPage);
        
        if (currentPage < totalPages) {
          currentPage++;
          updatePagination();
        }
      });
      
      lastPageBtn.addEventListener('click', () => {
        const filterValue = filterSelect.value;
        const searchValue = searchInput.value.toLowerCase() || mobileSearchInput.value.toLowerCase();
        
        let filteredPrompts = prompts;
        
        if (filterValue !== 'all') {
          filteredPrompts = filteredPrompts.filter(prompt => prompt.categoryId === filterValue);
        }
        
        if (searchValue) {
          filteredPrompts = filteredPrompts.filter(prompt => 
            prompt.title.toLowerCase().includes(searchValue) || 
            prompt.description.toLowerCase().includes(searchValue) ||
            (prompt.tags && prompt.tags.some(tag => tag.toLowerCase().includes(searchValue)))
          );
        }
        
        const totalPages = Math.ceil(filteredPrompts.length / itemsPerPage);
        currentPage = totalPages;
        updatePagination();
      });
      
      // 点击模态框背景关闭模态框
      promptModal.addEventListener('click', (e) => {
        if (e.target === promptModal) {
          closeModal(promptModal);
        }
      });
      
      categoryModal.addEventListener('click', (e) => {
        if (e.target === categoryModal) {
          closeModal(categoryModal);
        }
      });
      
      aiLinkModal.addEventListener('click', (e) => {
        if (e.target === aiLinkModal) {
          closeModal(aiLinkModal);
        }
      });
      
      exportOptionsModal.addEventListener('click', (e) => {
        if (e.target === exportOptionsModal) {
          closeModal(exportOptionsModal);
        }
      });
      
      promptDetailModal.addEventListener('click', (e) => {
        if (e.target === promptDetailModal) {
          closeModal(promptDetailModal);
        }
      });
      
      // 图片上传处理
      promptImageInput.addEventListener('change', handleImageUpload);
      
      // 移除预览图片
      removePreviewBtn.addEventListener('click', () => {
        imagePreview.classList.add('hidden');
        promptImageData.value = '';
        promptImageInput.value = '';
      });
      
      // 清除图片按钮
      clearImageBtn.addEventListener('click', () => {
        imagePreview.classList.add('hidden');
        promptImageData.value = '';
        promptImageInput.value = '';
        clearImageBtn.classList.add('hidden');
      });
      
      // 提示词表单提交
      promptForm.addEventListener('submit', (e) => {
        e.preventDefault();
        savePrompt();
      });
      
      // 分类表单提交
      categoryForm.addEventListener('submit', (e) => {
        e.preventDefault();
        saveCategory();
      });
      
      // AI链接表单提交
      aiLinkForm.addEventListener('submit', (e) => {
        e.preventDefault();
        saveAiLink();
      });
      
      // 筛选和排序变化
      filterSelect.addEventListener('change', () => {
        currentPage = 1;
        renderPrompts();
      });
      
      sortSelect.addEventListener('change', () => {
        currentPage = 1;
        renderPrompts();
      });
      
      // 搜索输入
      searchInput.addEventListener('input', () => {
        currentPage = 1;
        renderPrompts();
      });
      
      mobileSearchInput.addEventListener('input', () => {
        currentPage = 1;
        renderPrompts();
      });
      
      // 主题切换
      themeToggle.addEventListener('click', toggleTheme);
      
      // 移动端菜单切换
      mobileMenuBtn.addEventListener('click', toggleMobileMenu);
      
      // 分类颜色选择
      document.querySelectorAll('.color-option').forEach(button => {
        button.addEventListener('click', () => {
          // 移除所有选中状态
          document.querySelectorAll('.color-option').forEach(btn => {
            btn.classList.remove('ring-2', 'ring-offset-2');
          });
          
          // 添加选中状态
          button.classList.add('ring-2', 'ring-offset-2');
          
          // 更新隐藏输入值
          document.getElementById('category-color').value = button.dataset.color;
        });
      });
      
      // 分类图标选择
      document.querySelectorAll('.icon-option').forEach(button => {
        button.addEventListener('click', () => {
          // 移除所有选中状态
          document.querySelectorAll('.icon-option').forEach(btn => {
            btn.classList.remove('ring-2', 'ring-offset-2', 'ring-primary');
          });
          
          // 添加选中状态
          button.classList.add('ring-2', 'ring-offset-2', 'ring-primary');
          
          // 更新隐藏输入值
          document.getElementById('category-icon').value = button.dataset.icon;
        });
      });
      
      // 动态事件委托
      document.addEventListener('click', (e) => {
        // 点击提示词卡片查看详情（排除操作按钮）
        if (e.target.closest('.prompt-card') && !e.target.closest('.prompt-actions-btn') && !e.target.closest('.copy-prompt-btn') && !e.target.closest('.prompt-actions')) {
          const promptCard = e.target.closest('.prompt-card');
          const promptId = promptCard.dataset.promptId;
          openPromptDetail(promptId);
        }
        
        // 从操作菜单查看详情
        if (e.target.closest('.view-prompt-detail-btn')) {
          const button = e.target.closest('.view-prompt-detail-btn');
          const promptId = button.dataset.promptId;
          // 关闭操作菜单
          const actionsMenu = button.closest('.prompt-actions');
          if (actionsMenu) {
            actionsMenu.classList.add('hidden');
          }
          openPromptDetail(promptId);
        }
        
        // 复制提示词
        if (e.target.closest('.copy-prompt-btn')) {
          const button = e.target.closest('.copy-prompt-btn');
          const promptId = button.dataset.promptId;
          copyPrompt(promptId);
        }
        
        // 编辑提示词
        if (e.target.closest('.edit-prompt-btn')) {
          const button = e.target.closest('.edit-prompt-btn');
          const promptId = button.dataset.promptId;
          // 关闭操作菜单
          const actionsMenu = button.closest('.prompt-actions');
          if (actionsMenu) {
            actionsMenu.classList.add('hidden');
          }
          editPrompt(promptId);
        }
        
        // 删除提示词
        if (e.target.closest('.delete-prompt-btn')) {
          const button = e.target.closest('.delete-prompt-btn');
          const promptId = button.dataset.promptId;
          // 关闭操作菜单
          const actionsMenu = button.closest('.prompt-actions');
          if (actionsMenu) {
            actionsMenu.classList.add('hidden');
          }
          deletePrompt(promptId);
        }
        
        // 编辑分类
        if (e.target.closest('.edit-category-btn')) {
          const button = e.target.closest('.edit-category-btn');
          const categoryId = button.dataset.categoryId;
          editCategory(categoryId);
        }
        
        // 删除分类
        if (e.target.closest('.delete-category-btn')) {
          const button = e.target.closest('.delete-category-btn');
          const categoryId = button.dataset.categoryId;
          deleteCategory(categoryId);
        }
        
        // 编辑AI链接
        if (e.target.closest('.edit-ai-link-btn')) {
          const button = e.target.closest('.edit-ai-link-btn');
          const aiLinkId = button.dataset.aiLinkId;
          editAiLink(aiLinkId);
        }
        
        // 删除AI链接
        if (e.target.closest('.delete-ai-link-btn')) {
          const button = e.target.closest('.delete-ai-link-btn');
          const aiLinkId = button.dataset.aiLinkId;
          deleteAiLink(aiLinkId);
        }
      });
    }
    
    // 处理图片上传
    function handleImageUpload() {
      const file = promptImageInput.files[0];
      if (!file) return;
      
      // 检查文件类型
      if (!file.type.match('image.*')) {
        alert('请选择图片文件！');
        promptImageInput.value = '';
        return;
      }
      
      // 检查文件大小（限制为2MB）
      if (file.size > 2 * 1024 * 1024) {
        alert('图片大小不能超过2MB！');
        promptImageInput.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const imageData = e.target.result;
        promptImageData.value = imageData;
        previewImage.src = imageData;
        imagePreview.classList.remove('hidden');
        clearImageBtn.classList.remove('hidden');
      };
      reader.readAsDataURL(file);
    }
    
    // 打开提示词详情页
    function openPromptDetail(promptId) {
      const prompt = prompts.find(p => p.id === promptId);
      
      if (!prompt) return;
      
      currentDetailPrompt = prompt;
      
      // 填充详情页数据
      detailTitle.textContent = prompt.title;
      detailDescription.textContent = prompt.description;
      detailContent.textContent = prompt.content;
      usageCount.textContent = prompt.usageCount || 0;
      
      // 设置分类
      const category = categories.find(c => c.id === prompt.categoryId);
      if (category) {
        detailCategory.textContent = category.name;
        detailCategory.style.backgroundColor = category.color;
        detailCategory.style.color = '#ffffff';
      } else {
        detailCategory.textContent = '未分类';
        detailCategory.style.backgroundColor = '#6b7280';
        detailCategory.style.color = '#ffffff';
      }
      
      // 设置标签
      detailTags.innerHTML = '';
      if (prompt.tags && prompt.tags.length > 0) {
        prompt.tags.forEach(tag => {
          const tagElement = document.createElement('span');
          tagElement.className = 'bg-gray-100 dark:bg-gray-700 text-xs px-2 py-1 rounded-full';
          tagElement.textContent = tag;
          detailTags.appendChild(tagElement);
        });
      }
      
      // 设置图片（如果有）
      if (prompt.image) {
        detailImage.src = prompt.image;
        detailImageContainer.classList.remove('hidden');
      } else {
        detailImageContainer.classList.add('hidden');
      }
      
      // 设置日期
      detailCreatedAt.textContent = formatDate(prompt.createdAt);
      detailUpdatedAt.textContent = formatDate(prompt.updatedAt);
      
      // 显示详情模态框
      promptDetailModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 打开提示词模态框
    function openPromptModal(promptId = null) {
      // 重置表单
      promptForm.reset();
      document.getElementById('prompt-id').value = '';
      imagePreview.classList.add('hidden');
      clearImageBtn.classList.add('hidden');
      promptImageData.value = '';
      
      if (promptId) {
        // 编辑模式
        const prompt = prompts.find(p => p.id === promptId);
        if (prompt) {
          promptModalTitle.textContent = '编辑提示词';
          document.getElementById('prompt-id').value = prompt.id;
          document.getElementById('prompt-title').value = prompt.title;
          document.getElementById('prompt-description').value = prompt.description;
          document.getElementById('prompt-content').value = prompt.content;
          document.getElementById('prompt-category').value = prompt.categoryId;
          document.getElementById('prompt-tags').value = prompt.tags ? prompt.tags.join(', ') : '';
          
          // 如果有图片，显示预览
          if (prompt.image) {
            promptImageData.value = prompt.image;
            previewImage.src = prompt.image;
            imagePreview.classList.remove('hidden');
            clearImageBtn.classList.remove('hidden');
          }
        }
      } else {
        // 新建模式
        promptModalTitle.textContent = '新建提示词';
      }
      
      // 显示模态框
      promptModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 打开分类模态框
    function openCategoryModal(categoryId = null) {
      // 重置表单
      categoryForm.reset();
      document.getElementById('category-id').value = '';
      
      // 重置颜色和图标选择
      document.querySelectorAll('.color-option').forEach((btn, index) => {
        if (index === 0) {
          btn.classList.add('ring-2', 'ring-offset-2');
        } else {
          btn.classList.remove('ring-2', 'ring-offset-2');
        }
      });
      
      document.querySelectorAll('.icon-option').forEach((btn, index) => {
        if (index === 0) {
          btn.classList.add('ring-2', 'ring-offset-2', 'ring-primary');
        } else {
          btn.classList.remove('ring-2', 'ring-offset-2', 'ring-primary');
        }
      });
      
      if (categoryId) {
        // 编辑模式
        const category = categories.find(c => c.id === categoryId);
        if (category) {
          categoryModalTitle.textContent = '编辑分类';
          document.getElementById('category-id').value = category.id;
          document.getElementById('category-name').value = category.name;
          document.getElementById('category-color').value = category.color;
          document.getElementById('category-icon').value = category.icon;
          
          // 更新颜色选择
          document.querySelectorAll('.color-option').forEach(btn => {
            btn.classList.remove('ring-2', 'ring-offset-2');
            if (btn.dataset.color === category.color) {
              btn.classList.add('ring-2', 'ring-offset-2');
            }
          });
          
          // 更新图标选择
          document.querySelectorAll('.icon-option').forEach(btn => {
            btn.classList.remove('ring-2', 'ring-offset-2', 'ring-primary');
            if (btn.dataset.icon === category.icon) {
              btn.classList.add('ring-2', 'ring-offset-2', 'ring-primary');
            }
          });
        }
      } else {
        // 新建模式
        categoryModalTitle.textContent = '新建分类';
      }
      
      // 显示模态框
      categoryModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 打开AI链接模态框
    function openAiLinkModal(aiLinkId = null) {
      // 重置表单
      aiLinkForm.reset();
      document.getElementById('ai-link-id').value = '';
      
      if (aiLinkId) {
        // 编辑模式
        const aiLink = aiWebsites.find(a => a.id === aiLinkId);
        if (aiLink) {
          aiLinkModalTitle.textContent = '编辑AI网站链接';
          document.getElementById('ai-link-id').value = aiLink.id;
          document.getElementById('ai-link-name').value = aiLink.name;
          document.getElementById('ai-link-url').value = aiLink.url;
        }
      } else {
        // 新建模式
        aiLinkModalTitle.textContent = '添加AI网站链接';
      }
      
      // 显示模态框
      aiLinkModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 打开导出选项模态框
    function openExportOptionsModal() {
      // 重置选项
      document.querySelector('input[name="export-format"][value="structured"]').checked = true;
      includeImagesCheckbox.checked = true;
      filenameFormatSelect.value = 'title';
      
      // 显示模态框
      exportOptionsModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 显示导出进度模态框
    function showExportProgress() {
      exportProgressModal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    // 隐藏导出进度模态框
    function hideExportProgress() {
      exportProgressModal.classList.add('hidden');
      document.body.style.overflow = '';
    }
    
    // 更新导出进度
    function updateExportProgress(current, total, message) {
      const percentage = Math.round((current / total) * 100);
      exportProgressBar.style.width = `${percentage}%`;
      exportProgressText.textContent = message;
      exportStatus.textContent = `${current} / ${total}`;
    }
    
    // 关闭模态框
    function closeModal(modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = '';
    }
    
    // 保存提示词
    function savePrompt() {
      const id = document.getElementById('prompt-id').value;
      const title = document.getElementById('prompt-title').value;
      const description = document.getElementById('prompt-description').value;
      const content = document.getElementById('prompt-content').value;
      const categoryId = document.getElementById('prompt-category').value;
      const tagsInput = document.getElementById('prompt-tags').value;
      const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag !== '');
      const image = document.getElementById('prompt-image-data').value;
      
      const now = new Date().toISOString();
      
      if (id) {
        // 更新现有提示词
        const index = prompts.findIndex(p => p.id === id);
        if (index !== -1) {
          prompts[index] = {
            ...prompts[index],
            title,
            description,
            content,
            categoryId,
            tags,
            image,
            updatedAt: now
          };
        }
      } else {
        // 创建新提示词
        const newPrompt = {
          id: generateId(),
          title,
          description,
          content,
          categoryId,
          tags,
          image,
          usageCount: 0,
          createdAt: now,
          updatedAt: now
        };
        
        prompts.push(newPrompt);
      }
      
      // 保存数据
      savePrompts();
      
      // 更新UI
      renderPrompts();
      renderCategories();
      
      // 关闭模态框
      closeModal(promptModal);
    }
    
    // 保存分类
    function saveCategory() {
      const id = document.getElementById('category-id').value;
      const name = document.getElementById('category-name').value;
      const color = document.getElementById('category-color').value;
      const icon = document.getElementById('category-icon').value;
      
      const now = new Date().toISOString();
      
      if (id) {
        // 更新现有分类
        const index = categories.findIndex(c => c.id === id);
        if (index !== -1) {
          categories[index] = {
            ...categories[index],
            name,
            color,
            icon,
            updatedAt: now
          };
        }
      } else {
        // 创建新分类
        const newCategory = {
          id: generateId(),
          name,
          color,
          icon,
          createdAt: now,
          updatedAt: now
        };
        
        categories.push(newCategory);
      }
      
      // 保存数据
      saveCategories();
      
      // 更新UI
      renderCategories();
      renderPrompts();
      
      // 关闭模态框
      closeModal(categoryModal);
    }
    
    // 保存AI链接
    function saveAiLink() {
      const id = document.getElementById('ai-link-id').value;
      const name = document.getElementById('ai-link-name').value;
      const url = document.getElementById('ai-link-url').value;
      
      // 验证URL格式
      try {
        new URL(url);
      } catch (e) {
        alert('请输入有效的URL地址！');
        return;
      }
      
      if (id) {
        // 更新现有AI链接
        const index = aiWebsites.findIndex(a => a.id === id);
        if (index !== -1) {
          aiWebsites[index] = {
            ...aiWebsites[index],
            name,
            url
          };
        }
      } else {
        // 创建新AI链接
        const newAiLink = {
          id: generateId(),
          name,
          url
        };
        
        aiWebsites.push(newAiLink);
      }
      
      // 保存数据
      saveAiWebsites();
      
      // 更新UI
      renderAiLinks();
      
      // 关闭模态框
      closeModal(aiLinkModal);
    }
    
    // 编辑提示词
    function editPrompt(promptId) {
      openPromptModal(promptId);
    }
    
    // 删除提示词
    function deletePrompt(promptId) {
      if (confirm('确定要删除这个提示词吗？')) {
        prompts = prompts.filter(p => p.id !== promptId);
        savePrompts();
        renderPrompts();
        renderCategories();
      }
    }
    
    // 编辑分类
    function editCategory(categoryId) {
      openCategoryModal(categoryId);
    }
    
    // 删除分类
    function deleteCategory(categoryId) {
      // 检查是否有提示词使用此分类
      const promptsInCategory = prompts.filter(p => p.categoryId === categoryId);
      
      if (promptsInCategory.length > 0) {
        alert(`无法删除分类，有 ${promptsInCategory.length} 个提示词正在使用此分类。`);
        return;
      }
      
      if (confirm('确定要删除这个分类吗？')) {
        categories = categories.filter(c => c.id !== categoryId);
        
        saveCategories();
        renderCategories();
        renderPrompts();
      }
    }
    
    // 编辑AI链接
    function editAiLink(aiLinkId) {
      openAiLinkModal(aiLinkId);
    }
    
    // 删除AI链接
    function deleteAiLink(aiLinkId) {
      if (confirm('确定要删除这个AI网站链接吗？')) {
        aiWebsites = aiWebsites.filter(a => a.id !== aiLinkId);
        saveAiWebsites();
        renderAiLinks();
      }
    }
    
    // 复制提示词
    function copyPrompt(promptId) {
      const prompt = prompts.find(p => p.id === promptId);
      
      if (prompt) {
        // 复制到剪贴板
        navigator.clipboard.writeText(prompt.content)
          .then(() => {
            // 显示复制成功通知
            showCopyNotification();
            
            // 增加使用次数
            prompt.usageCount = (prompt.usageCount || 0) + 1;
            
            // 保存数据
            savePrompts();
            
            // 更新UI
            renderPrompts();
          })
          .catch(err => {
            console.error('复制失败:', err);
            alert('复制失败，请手动复制。');
          });
      }
    }
    
    // 显示复制成功通知
    function showCopyNotification() {
      copyNotification.classList.remove('translate-y-20', 'opacity-0');
      
      setTimeout(() => {
        copyNotification.classList.add('translate-y-20', 'opacity-0');
      }, 2000);
    }
    
    // 显示通用通知
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed bottom-4 right-4 bg-primary text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 flex items-center space-x-2';
      notification.innerHTML = `
        <i class="fa fa-info-circle"></i>
        <span>${message}</span>
      `;
      
      document.body.appendChild(notification);
      
      // 触发动画
      setTimeout(() => {
        notification.classList.remove('translate-y-20', 'opacity-0');
      }, 10);
      
      // 3秒后移除
      setTimeout(() => {
        notification.classList.add('translate-y-20', 'opacity-0');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // 清理文件名中的非法字符
    function sanitizeFilename(filename) {
      return filename.replace(/[<>:"/\\|?*]/g, '_');
    }
    
    // 生成文件夹名称
    function generateFolderName(prompt, format) {
      const title = sanitizeFilename(prompt.title);
      const now = new Date();
      const timestamp = now.getTime();
      const dateStr = now.toISOString().split('T')[0];
      
      switch(format) {
        case 'id-title':
          return `${prompt.id}_${title}`;
        case 'timestamp':
          return `${timestamp}_${title}`;
        case 'title':
        default:
          return title;
      }
    }
    
    // 从Base64字符串中提取图片格式
    function getImageFormatFromBase64(base64String) {
      if (!base64String) return null;
      
      // Base64字符串格式：data:image/jpeg;base64,...
      const match = base64String.match(/^data:image\/(\w+);base64,/);
      if (match && match[1]) {
        return match[1].toLowerCase();
      }
      
      return null;
    }
    
    // 从Base64字符串中提取图片数据
    function getImageDataFromBase64(base64String) {
      if (!base64String) return null;
      
      // 移除Base64前缀
      const base64Data = base64String.replace(/^data:image\/\w+;base64,/, '');
      return base64Data;
    }
    
    // 结构化导出提示词
    async function exportPromptsStructured() {
      const includeImages = includeImagesCheckbox.checked;
      const filenameFormat = filenameFormatSelect.value;
      
      // 显示导出进度
      showExportProgress();
      updateExportProgress(0, prompts.length, '正在准备导出文件...');
      
      try {
        // 创建ZIP文件
        const zip = new JSZip();
        
        // 创建主文件夹
        const mainFolderName = `ai-prompts-${new Date().toISOString().split('T')[0]}`;
        const mainFolder = zip.folder(mainFolderName);
        
        // 创建README文件
        const readmeContent = `AI提示词助手导出数据\n导出时间：${new Date().toLocaleString()}\n提示词总数：${prompts.length}\n\n每个提示词都保存在单独的文件夹中，包含：\n1. prompt.txt - 提示词详细信息\n2. image.jpg/png - 参考图片（如果有）`;
        mainFolder.file('README.txt', readmeContent);
        
        // 导出每个提示词
        for (let i = 0; i < prompts.length; i++) {
          const prompt = prompts[i];
          
          // 更新进度
          updateExportProgress(i + 1, prompts.length, `正在导出提示词：${prompt.title}...`);
          
          // 生成文件夹名称
          const folderName = generateFolderName(prompt, filenameFormat);
          const promptFolder = mainFolder.folder(folderName);
          
          // 创建提示词TXT文件
          const category = categories.find(c => c.id === prompt.categoryId);
          const categoryName = category ? category.name : '未分类';
          const tagsText = prompt.tags && prompt.tags.length > 0 ? prompt.tags.join(', ') : '无';
          
          const promptContent = `标题：${prompt.title}\n` +
                               `描述：${prompt.description}\n` +
                               `分类：${categoryName}\n` +
                               `标签：${tagsText}\n` +
                               `使用次数：${prompt.usageCount || 0}\n` +
                               `创建时间：${formatDate(prompt.createdAt)}\n` +
                               `更新时间：${formatDate(prompt.updatedAt)}\n` +
                               `\n` +
                               `提示词内容：\n` +
                               `${prompt.content}`;
          
          promptFolder.file('prompt.txt', promptContent);
          
          // 如果有图片且选择了包含图片
          if (includeImages && prompt.image) {
            const imageFormat = getImageFormatFromBase64(prompt.image);
            const imageData = getImageDataFromBase64(prompt.image);
            
            if (imageFormat && imageData) {
              // 确定文件扩展名
              const extension = imageFormat === 'jpeg' ? 'jpg' : imageFormat;
              const imageFilename = `image.${extension}`;
              
              // 将Base64转换为二进制数据
              const binaryData = atob(imageData);
              const array = new Uint8Array(binaryData.length);
              for (let j = 0; j < binaryData.length; j++) {
                array[j] = binaryData.charCodeAt(j);
              }
              
              // 添加图片文件到ZIP
              promptFolder.file(imageFilename, array);
            }
          }
        }
        
        // 生成ZIP文件
        updateExportProgress(prompts.length, prompts.length, '正在生成ZIP文件...');
        
        const zipBlob = await zip.generateAsync({ type: 'blob' });
        
        // 保存文件
        saveAs(zipBlob, `${mainFolderName}.zip`);
        
        // 隐藏导出进度
        hideExportProgress();
        
        // 显示成功通知
        showNotification('提示词已成功导出为结构化ZIP文件！');
      } catch (error) {
        console.error('导出失败:', error);
        hideExportProgress();
        alert('导出失败：' + error.message);
      }
    }
    
    // 简单TXT导出
    function exportPromptsAsSimpleTxt() {
      // 获取所有提示词内容，每个提示词之间用分隔线隔开
      const promptsText = prompts.map(prompt => {
        const category = categories.find(c => c.id === prompt.categoryId);
        const categoryName = category ? category.name : '未分类';
        const tagsText = prompt.tags && prompt.tags.length > 0 ? prompt.tags.join(', ') : '无';
        
        return `【${prompt.title}】\n` +
               `描述：${prompt.description}\n` +
               `分类：${categoryName}\n` +
               `标签：${tagsText}\n` +
               `使用次数：${prompt.usageCount || 0}\n` +
               `\n${prompt.content}\n` +
               '\n' + '='.repeat(60) + '\n';
      }).join('\n');
      
      // 创建Blob对象并下载
      const blob = new Blob([promptsText], { type: 'text/plain;charset=utf-8' });
      saveAs(blob, `ai-prompts-${new Date().toISOString().split('T')[0]}.txt`);
      
      // 显示提示
      showNotification('提示词已成功导出为TXT文件！');
    }
    
    // JSON导出
    function exportDataAsJson() {
      const data = {
        prompts: prompts,
        categories: categories,
        aiWebsites: aiWebsites,
        exportInfo: {
          exportedAt: new Date().toISOString(),
          version: '1.1'
        }
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      saveAs(dataBlob, 'ai-prompt-assistant-backup.json');
      
      showNotification('数据已导出成功！');
    }
    
    // 格式化日期
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
    }
    
    // 切换主题
    function toggleTheme() {
      document.documentElement.classList.toggle('dark');
      
      // 保存主题偏好
      const isDarkMode = document.documentElement.classList.contains('dark');
      localStorage.setItem('ai-prompt-assistant-theme', isDarkMode ? 'dark' : 'light');
    }
    
    // 检查主题偏好
    function checkThemePreference() {
      const savedTheme = localStorage.getItem('ai-prompt-assistant-theme');
      
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
      } else if (savedTheme === 'light') {
        document.documentElement.classList.remove('dark');
      } else {
        // 默认根据系统偏好
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) {
          document.documentElement.classList.add('dark');
        }
      }
    }
    
    // 切换移动端菜单
    function toggleMobileMenu() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('hidden');
    }
    
    // 生成唯一ID
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
    }
    
    // HTML转义
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // 启动应用
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>